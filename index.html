<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Mail Aktion: Gaza-Freedom-Flotilla</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS bleibt unverändert wie in Ihrer Vorlage */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-envelope"></i> E-Mail Aktion: Gaza-Freedom-Flotilla</h1>
            <p class="subtitle">Senden Sie eine E-Mail an Ihre Abgeordneten, um die Sicherheit der Aktivist:innen auf der "Madleen" zu fordern</p>
        </header>
        
        <div class="content">
            <div class="info-box">
                <h3><i class="fas fa-info-circle"></i> Worum geht es?</h3>
                <p>Die deutsche Staatsbürgerin Yasemin Acar befindet sich an Bord der Gaza-Freedom-Flotilla "Madleen". Israel hat militärische Angriffe auf das zivile Schiff in internationalen Gewässern angedroht. Vor dem Hintergrund früherer Angriffe auf ähnliche Flotillas ist diese Drohung besonders ernst zu nehmen.</p>
            </div>
            
            <h2>E-Mail-Vorlage an Abgeordnete:</h2>
            <div class="email-template">
Sehr geehrte Abgeordnete des Auswärtigen Amts/des Auswärtigen Ausschusses,

derzeit befindet sich die deutsche Staatsbürgerin Yasemin Acar an Bord der Gaza-Freedom-Flotilla „Madleen".
Gemeinsam mit anderen Aktivist:innen versucht sie, Israels völkerrechtswidrige Blockade des Gazastreifens zu durchbrechen, um Lebensmittel und medizinische Vorräte nach Gaza zu bringen. Israels Verteidigungsminister kündigt offen den Einsatz der israelischen Armee gegen dieses Vorhaben an und droht einem zivilen Schiff in internationalen Gewässern mit militärischen Angriffen.

Diese Drohungen sind besonders ernst zu nehmen vor dem Hintergrund des israelischen Angriffs auf die Gaza-Flotilla im Mai 2010, bei dem Israel neun Aktivist:innen tötete und Dutzende verwundete, sowie aufgrund der Drohnenangriffe auf die Gaza-Flotilla „Conscience" vor etwa einem Monat.

Ich fordere Sie daher auf, alle zur Verfügung stehenden Mittel zu nutzen, um die Sicherheit der Aktivist:innen auf der „Madleen" zu gewährleisten.

Mit freundlichen Grüßen,
[Ihr Name]
            </div>
            
            <div class="steps">
                <div class="step">
                    <i class="fas fa-map-marker-alt"></i>
                    <h3>Schritt 1</h3>
                    <p>Geben Sie Ihre Postleitzahl ein, um Ihre lokalen Abgeordneten zu finden</p>
                </div>
                <div class="step">
                    <i class="fas fa-search"></i>
                    <h3>Schritt 2</h3>
                    <p>Wir identifizieren die zuständigen Abgeordneten für Ihre Region</p>
                </div>
                <div class="step">
                    <i class="fas fa-paper-plane"></i>
                    <h3>Schritt 3</h3>
                    <p>E-Mail wird vorbereitet und kann direkt versendet werden</p>
                </div>
            </div>
            
            <div class="input-section">
                <h2><i class="fas fa-envelope-open-text"></i> E-Mail jetzt versenden</h2>
                <p>Geben Sie Ihre Postleitzahl ein, um die Aktion zu starten:</p>
                
                <div class="input-group">
                    <label for="plz">Ihre Postleitzahl:</label>
                    <input type="text" id="plz" placeholder="5-stellige PLZ (z.B. 10117)" maxlength="5">
                    <p class="note">Wir verwenden Ihre PLZ, um die für Sie zuständigen Abgeordneten zu finden</p>
                </div>
                
                <button onclick="findRepresentative()">
                    <i class="fas fa-paper-plane"></i> Jetzt E-Mail an Abgeordnete schicken
                </button>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Suche Abgeordnete für Ihre Region...</p>
                </div>
                
                <div class="error" id="error">
                    <i class="fas fa-exclamation-triangle"></i> <span id="error-message"></span>
                </div>
            </div>
            
            <div class="result-section" id="result-section">
                <h2><i class="fas fa-check-circle"></i> Abgeordnete gefunden!</h2>
                <p>Wir haben folgende Abgeordnete für Ihre Region identifiziert:</p>
                
                <div class="representative-info" id="representative-info">
                    <!-- Dynamisch gefüllt -->
                </div>
                
                <button onclick="sendEmail()">
                    <i class="fas fa-envelope"></i> E-Mail jetzt öffnen und senden
                </button>
            </div>
        </div>
        
        <footer>
            <p>Diese Kampagne dient dem Schutz von Menschenrechten und zivilgesellschaftlichem Engagement</p>
            <p>© 2023 Initiative für Frieden und Menschenrechte</p>
        </footer>
    </div>

    <script>
        // Globale Variable für die gefundenen Abgeordneten
        let representatives = [];
        
        // Funktion zum Suchen der Abgeordneten per PLZ
        async function findRepresentative() {
            const plz = document.getElementById('plz').value;
            
            // PLZ-Validierung
            if (!/^\d{5}$/.test(plz)) {
                showError("Bitte geben Sie eine gültige 5-stellige Postleitzahl ein");
                return;
            }
            
            // Ladeanimation anzeigen
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('result-section').style.display = 'none';
            
            try {
                // Abgeordnetenwatch-API für Wahlkreis-Suche
                const response = await fetch(`https://www.abgeordnetenwatch.de/api/v2/constituencies?zipcode=${plz}&parliament=5`);
                const data = await response.json();
                
                if (!data.data || data.data.length === 0) {
                    showError("Für Ihre PLZ wurde kein Wahlkreis gefunden. Bitte versuchen Sie eine benachbarte PLZ.");
                    return;
                }
                
                // Wahlkreis-ID extrahieren
                const constituencyId = data.data[0].id;
                
                // Abgeordnete für den Wahlkreis abrufen
                const membersResponse = await fetch(`https://www.abgeordnetenwatch.de/api/v2/candidacies-mandates?constituency=${constituencyId}&mandate_type=1&parliament=5&is_active=true`);
                const membersData = await membersResponse.json();
                
                if (!membersData.data || membersData.data.length === 0) {
                    showError("Für Ihren Wahlkreis wurden keine aktiven Abgeordneten gefunden.");
                    return;
                }
                
                // Abgeordnete aufbereiten
                representatives = membersData.data.map(member => ({
                    id: member.id,
                    name: member.politician.label,
                    email: member.politician.contact.email,
                    party: member.politician.party,
                    constituency: data.data[0].name
                }));
                
                // Ergebnisse anzeigen
                showRepresentatives();
                
            } catch (error) {
                showError("Es gab ein Problem bei der Suche nach Abgeordneten. Bitte versuchen Sie es später erneut.");
                console.error("API Fehler:", error);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // Funktion zum Anzeigen der Abgeordneten
        function showRepresentatives() {
            const repInfo = document.getElementById('representative-info');
            repInfo.innerHTML = '';
            
            if (representatives.length === 0) {
                repInfo.innerHTML = '<p>Keine Abgeordneten gefunden</p>';
                return;
            }
            
            representatives.forEach(rep => {
                const repDiv = document.createElement('div');
                repDiv.className = 'representative-item';
                repDiv.innerHTML = `
                    <h3>${rep.name}</h3>
                    <p><strong>Partei:</strong> ${rep.party}</p>
                    <p><strong>Wahlkreis:</strong> ${rep.constituency}</p>
                    <p><strong>E-Mail:</strong> ${rep.email || 'Keine E-Mail verfügbar'}</p>
                    <hr>
                `;
                repInfo.appendChild(repDiv);
            });
            
            document.getElementById('result-section').style.display = 'block';
        }
        
        // Funktion zum Anzeigen von Fehlermeldungen
        function showError(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error').style.display = 'block';
        }
        
        // Funktion zum Erstellen und Senden der E-Mail
        function sendEmail() {
            if (representatives.length === 0) {
                showError("Bitte suchen Sie zuerst nach Abgeordneten");
                return;
            }
            
            // Nur Abgeordnete mit E-Mail-Adresse
            const validReps = representatives.filter(rep => rep.email);
            
            if (validReps.length === 0) {
                showError("Keine der gefundenen Abgeordneten hat eine öffentliche E-Mail-Adresse");
                return;
            }
            
            // E-Mail-Inhalt
            const subject = "Dringender Appell: Sicherheit der Aktivist:innen auf der Madleen gewährleisten";
            const body = `Sehr geehrte Abgeordnete des Auswärtigen Amts/des Auswärtigen Ausschusses,

derzeit befindet sich die deutsche Staatsbürgerin Yasemin Acar an Bord der Gaza-Freedom-Flotilla „Madleen".
Gemeinsam mit anderen Aktivist:innen versucht sie, Israels völkerrechtswidrige Blockade des Gazastreifens zu durchbrechen, um Lebensmittel und medizinische Vorräte nach Gaza zu bringen. Israels Verteidigungsminister kündigt offen den Einsatz der israelischen Armee gegen dieses Vorhaben an und droht einem zivilen Schiff in internationalen Gewässern mit militärischen Angriffen.

Diese Drohungen sind besonders ernst zu nehmen vor dem Hintergrund des israelischen Angriffs auf die Gaza-Flotilla im Mai 2010, bei dem Israel neun Aktivist:innen tötete und Dutzende verwundete, sowie aufgrund der Drohnenangriffe auf die Gaza-Flotilla „Conscience" vor etwa einem Monat.

Ich fordere Sie daher auf, alle zur Verfügung stehenden Mittel zu nutzen, um die Sicherheit der Aktivist:innen auf der „Madleen" zu gewährleisten.

Mit freundlichen Grüßen,
[Ihr Name]`;

            // Mailto-Link erstellen (alle Empfänger in BCC)
            const bccEmails = validReps.map(rep => rep.email).join(',');
            const mailtoLink = `mailto:?bcc=${encodeURIComponent(bccEmails)}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Mail-Client öffnen
            window.location.href = mailtoLink;
        }
    </script>
</body>
</html>
